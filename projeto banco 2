-- MySQL Script generated by MySQL Workbench
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';


-- Schema editora
CREATE SCHEMA IF NOT EXISTS `editora` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `editora` ;

-- Table `editora`.`cliente`

CREATE TABLE IF NOT EXISTS `editora`.`cliente` (
  `id_cliente` INT NOT NULL,
  `nome_cliente` VARCHAR(45) NOT NULL,
  `endereco_cliente` VARCHAR(45) NOT NULL,
  `telefone_cliente` VARCHAR(45) NOT NULL,
  `email_cliente` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_cliente`))
ENGINE = InnoDB;

-- Table `editora`.`funcionarios`

CREATE TABLE IF NOT EXISTS `editora`.`funcionarios` (
  `cpf` VARCHAR(14) NOT NULL,
  `nome` VARCHAR(60) NOT NULL,
  `nomeSocial` VARCHAR(45) NULL,
  `email` VARCHAR(45) NOT NULL,
  `sexo` CHAR(1) NOT NULL,
  `estadoCivil` VARCHAR(15) NOT NULL,
  `dataNasc` DATE NOT NULL,
  `ch` INT NOT NULL,
  `salario` DECIMAL(7,2) NOT NULL,
  `endereco` VARCHAR(60) NOT NULL,
  `dataAdm` DATETIME NOT NULL,
  `dataDem` DATETIME NULL,
  PRIMARY KEY (`cpf`))
ENGINE = InnoDB;


-- Table `editora`.`departamento`
CREATE TABLE IF NOT EXISTS `editora`.`departamento` (
  `id_departamento` INT NOT NULL,
  `nome_departamento` VARCHAR(45) NOT NULL,
  `responsavel_departamento` VARCHAR(45) NOT NULL,
  `descrição_departamento` VARCHAR(45) NOT NULL,
  `funcionarios_cpf` VARCHAR(14) NOT NULL,
  PRIMARY KEY (`id_departamento`, `funcionarios_cpf`),
  INDEX `fk_departamento_funcionarios1_idx` (`funcionarios_cpf` ASC) VISIBLE,
  CONSTRAINT `fk_departamento_funcionarios1`
    FOREIGN KEY (`funcionarios_cpf`)
    REFERENCES `editora`.`funcionarios` (`cpf`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- Table `editora`.`livro`
CREATE TABLE IF NOT EXISTS `editora`.`livro` (
  `isb` INT NOT NULL,
  `titulo` VARCHAR(45) NOT NULL,
  `editora` VARCHAR(45) NOT NULL,
  `data_lancamento` DATETIME NOT NULL,
  `genero` VARCHAR(20) NOT NULL,
  `numero_paginas` DECIMAL NOT NULL,
  `descrição` VARCHAR(45) NULL,
  `cliente_id_cliente` INT NOT NULL,
  PRIMARY KEY (`isb`, `cliente_id_cliente`),
  INDEX `fk_livro_cliente1_idx` (`cliente_id_cliente` ASC) VISIBLE,
  CONSTRAINT `fk_livro_cliente1`
    FOREIGN KEY (`cliente_id_cliente`)
    REFERENCES `editora`.`cliente` (`id_cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- Table `editora`.`pedidoVendas`

CREATE TABLE IF NOT EXISTS `editora`.`pedidoVendas` (
  `id_pedido` INT NOT NULL,
  `cliente_id_cliente` INT NOT NULL,
  `data_transacao` DATE NOT NULL,
  `status_pedido` VARCHAR(45) NOT NULL,
  `detalhes_pagamento` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_pedido`, `cliente_id_cliente`),
  INDEX `fk_pedidoVendas_cliente_idx` (`cliente_id_cliente` ASC) VISIBLE,
  CONSTRAINT `fk_pedidoVendas_cliente`
    FOREIGN KEY (`cliente_id_cliente`)
    REFERENCES `editora`.`cliente` (`id_cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- Table `editora`.`autor`

CREATE TABLE IF NOT EXISTS `editora`.`autor` (
  `id_autor` INT NOT NULL,
  `nome` VARCHAR(45) NOT NULL,
  `biografia` VARCHAR(45) NOT NULL,
  `data_nascimento` DATE NOT NULL,
  `livro_isb` INT NOT NULL,
  PRIMARY KEY (`id_autor`, `livro_isb`),
  INDEX `fk_autor_livro1_idx` (`livro_isb` ASC) VISIBLE,
  CONSTRAINT `fk_autor_livro1`
    FOREIGN KEY (`livro_isb`)
    REFERENCES `editora`.`livro` (`isb`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- Table `editora`.`exemplares`

CREATE TABLE IF NOT EXISTS `editora`.`exemplares` (
  `numero_serie` DECIMAL NOT NULL,
  `isbn` VARCHAR(45) NOT NULL,
  `condicao_exemplar` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`numero_serie`))
ENGINE = InnoDB;

-- Table `editora`.`palavraChave`

CREATE TABLE IF NOT EXISTS `editora`.`palavraChave` (
  `codg_palavrachave` INT NOT NULL,
  `descrição_palavrachave` VARCHAR(45) NOT NULL,
  `livro_isb` INT NOT NULL,
  `livro_cliente_id_cliente` INT NOT NULL,
  PRIMARY KEY (`codg_palavrachave`, `livro_isb`, `livro_cliente_id_cliente`),
  INDEX `fk_palavraChave_livro1_idx` (`livro_isb` ASC, `livro_cliente_id_cliente` ASC) VISIBLE,
  CONSTRAINT `fk_palavraChave_livro1`
    FOREIGN KEY (`livro_isb` , `livro_cliente_id_cliente`)
    REFERENCES `editora`.`livro` (`isb` , `cliente_id_cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- Table `editora`.`areaDeconhecimento`

CREATE TABLE IF NOT EXISTS `editora`.`areaDeconhecimento` (
  `codigo_area` INT NOT NULL,
  `descrição_area` VARCHAR(45) NOT NULL,
  `livro_isb` INT NOT NULL,
  PRIMARY KEY (`codigo_area`, `livro_isb`),
  INDEX `fk_areaDeconhecimento_livro1_idx` (`livro_isb` ASC) VISIBLE,
  CONSTRAINT `fk_areaDeconhecimento_livro1`
    FOREIGN KEY (`livro_isb`)
    REFERENCES `editora`.`livro` (`isb`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- Table `editora`.`cargo`

CREATE TABLE IF NOT EXISTS `editora`.`cargo` (
  `id_cargo` INT NOT NULL,
  `nome_cargo` VARCHAR(45) NOT NULL,
  `descrição_cargo` VARCHAR(45) NOT NULL,
  `funcionarios_cpf` VARCHAR(14) NOT NULL,
  PRIMARY KEY (`id_cargo`, `funcionarios_cpf`),
  INDEX `fk_cargo_funcionarios1_idx` (`funcionarios_cpf` ASC) VISIBLE,
  CONSTRAINT `fk_cargo_funcionarios1`
    FOREIGN KEY (`funcionarios_cpf`)
    REFERENCES `editora`.`funcionarios` (`cpf`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- Table `editora`.`itensVenda`

CREATE TABLE IF NOT EXISTS `editora`.`itensVenda` (
  `valorVenda` DECIMAL NOT NULL,
  `quantidade` VARCHAR(11) NOT NULL,
  `desconto` DECIMAL NULL,
  `funcionarios_cpf` VARCHAR(14) NOT NULL,
  `pedidoVendas_id_pedido` INT NOT NULL,
  PRIMARY KEY (`funcionarios_cpf`, `pedidoVendas_id_pedido`),
  INDEX `fk_table1_pedidoVendas1_idx` (`pedidoVendas_id_pedido` ASC) VISIBLE,
  CONSTRAINT `fk_table1_funcionarios1`
    FOREIGN KEY (`funcionarios_cpf`)
    REFERENCES `editora`.`funcionarios` (`cpf`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_table1_pedidoVendas1`
    FOREIGN KEY (`pedidoVendas_id_pedido`)
    REFERENCES `editora`.`pedidoVendas` (`id_pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- Table `editora`.`ferias`

CREATE TABLE IF NOT EXISTS `editora`.`ferias` (
  `idferias` INT NOT NULL,
  `dataInicio` DATE NOT NULL,
  `dataFim` DATE NOT NULL,
  `qtdDias` INT NOT NULL,
  `anoRef` YEAR(4) NOT NULL,
  `funcionarios_cpf` VARCHAR(14) NOT NULL,
  PRIMARY KEY (`idferias`),
  INDEX `fk_ferias_funcionarios1_idx` (`funcionarios_cpf` ASC) VISIBLE,
  CONSTRAINT `fk_ferias_funcionarios1`
    FOREIGN KEY (`funcionarios_cpf`)
    REFERENCES `editora`.`funcionarios` (`cpf`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- Table `escola_musica`.`enderecoFunc`

CREATE TABLE IF NOT EXISTS `editora`.`enderecoFunc` (
  `uf` CHAR(14) NOT NULL,
  `cidade` VARCHAR(45) NOT NULL,
  `bairro` VARCHAR(45) NOT NULL,
  `rua` VARCHAR(45) NOT NULL,
  `numero` INT NOT NULL,
  `complemento` VARCHAR(45) NULL,
  `cep` VARCHAR(9) NOT NULL,
  `funcionarios_cpf` VARCHAR(14) NOT NULL,
  PRIMARY KEY (`funcionarios_cpf`),
  CONSTRAINT `fk_enderecoFunc_funcionarios1`
    FOREIGN KEY (`funcionarios_cpf`)
    REFERENCES `editora`.`funcionarios` (`cpf`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- Table `editora`.`enderecoCliente`

CREATE TABLE IF NOT EXISTS `editora`.`enderecoCliente` (
  `uf` VARCHAR(45) NOT NULL,
  `cidade` VARCHAR(45) NOT NULL,
  `bairro` VARCHAR(45) NOT NULL,
  `rua` VARCHAR(70) NOT NULL,
  `numero` INT(11) NOT NULL,
  `complemento` VARCHAR(45) NULL,
  `cep` VARCHAR(9) NOT NULL,
  `cliente_id_cliente` INT NOT NULL,
  PRIMARY KEY (`cliente_id_cliente`),
  CONSTRAINT `fk_enderecoCliente_cliente1`
    FOREIGN KEY (`cliente_id_cliente`)
    REFERENCES `editora`.`cliente` (`id_cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

-- item 2 editar tabelas-- 
ALTER TABLE editora.cliente
ADD COLUMN data_cadastro DATE;

ALTER TABLE editora.livro
MODIFY COLUMN numero_paginas INT;

ALTER TABLE editora.funcionarios
MODIFY COLUMN nomeSocial VARCHAR(45) NOT NULL;

ALTER TABLE editora.cliente
ADD UNIQUE (email_cliente);

ALTER TABLE editora.cliente
ADD INDEX idx_nome_cliente (nome_cliente);

ALTER TABLE editora.departamento
CHANGE COLUMN descrição_departamento descricao_departamento VARCHAR(45);

ALTER TABLE editora.pedidoVendas
ALTER COLUMN status_pedido SET DEFAULT 'Em Aberto';

ALTER TABLE editora.autor
MODIFY COLUMN biografia VARCHAR(200);

ALTER TABLE editora.livro
ADD COLUMN observacoes TEXT;

ALTER TABLE editora.funcionarios
ADD COLUMN ativo BOOLEAN DEFAULT TRUE;

-- Desativar temporariamente as verificações de chaves estrangeiras
SET FOREIGN_KEY_CHECKS = 0;

-- Item 3 Excluir tabelas 
DROP TABLE IF EXISTS itensVenda;
DROP TABLE IF EXISTS ferias;
DROP TABLE IF EXISTS enderecoFunc;
DROP TABLE IF EXISTS enderecoCliente;
DROP TABLE IF EXISTS cargo;
DROP TABLE IF EXISTS departamento;
DROP TABLE IF EXISTS autor;
DROP TABLE IF EXISTS palavraChave;
DROP TABLE IF EXISTS areaDeconhecimento;
DROP TABLE IF EXISTS exemplares;
DROP TABLE IF EXISTS pedidoVendas;
DROP TABLE IF EXISTS livro;
DROP TABLE IF EXISTS funcionarios;
DROP TABLE IF EXISTS cliente;

-- Reativar as verificações de chaves estrangeiras
SET FOREIGN_KEY_CHECKS = 1;

-- Item 4 Inserindo dados na tabela cliente
INSERT INTO editora.cliente (id_cliente, nome_cliente, endereco_cliente, telefone_cliente, email_cliente, data_cadastro) VALUES
(1, 'Ana Souza', 'Rua das Flores, 123', '(81) 99999-1111', 'ana.souza@email.com', '2025-05-10'),
(2, 'Pedro Alves', 'Av. Beira Mar, 456', '(81) 98888-2222', 'pedro.alves@email.com', '2025-05-11'),
(3, 'Carla Mendes', 'Travessa da Paz, 789', '(81) 97777-3333', 'carla.mendes@email.com', '2025-05-12'),
(4, 'Lucas Oliveira', 'Rua do Sol, 1011', '(81) 96666-4444', 'lucas.oliveira@email.com', '2025-05-13'),
(5, 'Mariana Costa', 'Praça da Matriz, 1213', '(81) 95555-5555', 'mariana.costa@email.com', '2025-05-14'),
(6, 'Ricardo Pereira', 'Estrada do Mar, 1415', '(81) 94444-6666', 'ricardo.pereira@email.com', '2025-05-15'),
(7, 'Juliana Santos', 'Avenida Central, 1617', '(81) 93333-7777', 'juliana.santos@email.com', '2025-05-16'),
(8, 'Fernando Lima', 'Rua da Aurora, 1819', '(81) 92222-8888', 'fernando.lima@email.com', '2025-05-17'),
(9, 'Beatriz Barros', 'Largo da Igreja, 2021', '(81) 91111-9999', 'beatriz.barros@email.com', '2025-05-18'),
(10, 'Gustavo Rocha', 'Rua Nova, 2223', '(81) 90000-0000', 'gustavo.rocha@email.com', '2025-05-19');

-- Inserindo dados na tabela funcionarios
INSERT INTO editora.funcionarios (cpf, nome, nomeSocial, email, sexo, estadoCivil, dataNasc, ch, salario, endereco, dataAdm, dataDem, ativo) VALUES
('111.111.111-11', 'Carlos Alberto', 'Carlos Alberto', 'carlos.alberto@email.com', 'M', 'Casado', '1980-01-15', 40, 3500.00, 'Rua A, 10', '2020-07-01', NULL, TRUE),
('222.222.222-22', 'Sofia Mendes', 'Sofia M.', 'sofia.mendes@email.com', 'F', 'Solteira', '1992-05-20', 40, 2800.00, 'Av. B, 25', '2021-03-10', NULL, TRUE),
('333.333.333-33', 'Roberto Silva', 'Roberto Silva', 'roberto.silva@email.com', 'M', 'Divorciado', '1975-11-30', 40, 4200.00, 'Rua C, 100', '2019-01-05', '2024-12-20', FALSE),
('444.444.444-44', 'Amanda Pereira', 'Amanda Pereira', 'amanda.pereira@email.com', 'F', 'Casada', '1988-08-12', 40, 3100.00, 'Travessa D, 50', '2022-09-15', NULL, TRUE),
('555.555.555-55', 'Júlio César', 'Júlio C.', 'julio.cesar@email.com', 'M', 'Solteiro', '1995-02-01', 40, 2500.00, 'Rua E, 70', '2023-05-01', NULL, TRUE),
('666.666.666-66', 'Patrícia Oliveira', 'Patrícia Oliveira', 'patricia.oliveira@email.com', 'F', 'Viúva', '1982-04-25', 40, 3800.00, 'Av. F, 120', '2021-11-01', NULL, TRUE),
('777.777.777-77', 'Ricardo Alves', 'Ricardo Alves', 'ricardo.alves@email.com', 'M', 'Casado', '1979-09-10', 40, 3300.00, 'Rua G, 30', '2020-03-15', NULL, TRUE),
('888.888.888-88', 'Fernanda Costa', 'Fer Costa', 'fernanda.costa@email.com', 'F', 'Solteira', '1990-07-05', 40, 2900.00, 'Travessa H, 80', '2022-01-10', NULL, TRUE),
('999.999.999-99', 'Marcelo Santos', 'Marcelo Santos', 'marcelo.santos@email.com', 'M', 'Divorciado', '1977-12-28', 40, 4000.00, 'Rua I, 150', '2019-07-20', NULL, TRUE),
('000.000.000-00', 'Isabela Lima', 'Isabela Lima', 'isabela.lima@email.com', 'F', 'Casada', '1985-06-18', 40, 3200.00, 'Av. J, 45', '2023-10-01', NULL, TRUE);

-- Inserindo dados na tabela departamento (CORRIGIDO)
INSERT INTO editora.departamento (id_departamento, nome_departamento, responsavel_departamento, descricao_departamento, funcionarios_cpf) VALUES
(101, 'Marketing', 'Sofia Mendes', 'Departamento de Marketing e Vendas', '222.222.222-22'),
(102, 'Editorial', 'Carlos Alberto', 'Departamento de Edição e Produção de Livros', '111.111.111-11'),
(103, 'Financeiro', 'Patrícia Oliveira', 'Departamento de Contas e Finanças', '666.666.666-66'),
(104, 'Recursos Humanos', 'Amanda Pereira', 'Departamento de Gestão de Pessoas', '444.444.444-44'),
(105, 'Logística', 'Roberto Silva', 'Departamento de Distribuição e Estoque', '333.333.333-33'),
(106, 'TI', 'Júlio César', 'Departamento de Tecnologia da Informação', '555.555.555-55'),
(107, 'Comercial', 'Ricardo Alves', 'Departamento de Vendas e Negociações', '777.777.777-77'),
(108, 'Design', 'Fernanda Costa', 'Departamento de Design Gráfico e Diagramação', '888.888.888-88'),
(109, 'Jurídico', 'Marcelo Santos', 'Departamento de Assuntos Legais', '999.999.999-99'),
(110, 'Administração', 'Isabela Lima', 'Departamento Administrativo Geral', '000.000.000-00');

-- Inserindo dados na tabela livro
INSERT INTO editora.livro (isb, titulo, editora, data_lancamento, genero, numero_paginas, descrição, cliente_id_cliente, observacoes) VALUES
(1001, 'A Montanha Mágica', 'Nova Estrela', '2024-08-15 00:00:00', 'Romance', 650, 'Um clássico da literatura alemã.', 1, NULL),
(1002, 'Cem Anos de Solidão', 'Sol e Lua', '2023-05-20 00:00:00', 'Ficção Histórica', 400, 'A saga da família Buendía.', 2, 'Best-seller atemporal'),
(1003, '1984', 'Mundo Novo', '2022-11-10 00:00:00', 'Distopia', 320, 'Um futuro sombrio e totalitário.', 3, NULL),
(1004, 'O Pequeno Príncipe', 'Estrela Cadente', '2025-01-25 00:00:00', 'Infantil', 90, 'Uma fábula sobre a amizade e a vida.', 4, 'Livro para todas as idades'),
(1005, 'Dom Quixote', 'Aventura Real', '2024-03-01 00:00:00', 'Aventura', 800, 'As aventuras de um cavaleiro sonhador.', 5, NULL),
(1006, 'Orgulho e Preconceito', 'Clássicos Ingleses', '2023-09-05 00:00:00', 'Romance', 430, 'A história de Elizabeth Bennet e Mr. Darcy.', 6, 'Adaptações para o cinema'),
(1007, 'O Senhor dos Anéis', 'Terra Média', '2022-07-12 00:00:00', 'Fantasia', 1200, 'A épica jornada para destruir o Um Anel.', 7, 'Trilogia famosa'),
(1008, 'Harry Potter e a Pedra Filosofal', 'Magia Pura', '2025-04-01 00:00:00', 'Fantasia', 250, 'O início da jornada do jovem bruxo.', 8, 'Primeiro de uma série'),
(1009, 'Crime e Castigo', 'Alma Humana', '2024-06-18 00:00:00', 'Drama', 550, 'A luta interna de um assassino.', 9, NULL),
(1010, 'A Metamorfose', 'Existencialismo', '2023-12-20 00:00:00', 'Ficção', 150, 'A estranha transformação de Gregor Samsa.', 10, 'Obra marcante');

-- Inserindo dados na tabela pedidoVendas
INSERT INTO editora.pedidoVendas (id_pedido, cliente_id_cliente, data_transacao, status_pedido, detalhes_pagamento) VALUES
(2001, 1, '2025-05-20', 'Concluído', 'Cartão de Crédito'),
(2002, 2, '2025-05-20', 'Em Aberto', 'Boleto Bancário'),
(2003, 3, '2025-05-21', 'Concluído', 'Pix'),
(2004, 4, '2025-05-21', 'Enviado', 'Cartão de Débito'),
(2005, 5, '2025-05-22', 'Processando', 'Cartão de Crédito'),
(2006, 6, '2025-05-22', 'Concluído', 'Transferência Bancária'),
(2007, 7, '2025-05-23', 'Em Aberto', 'Boleto Bancário'),
(2008, 8, '2025-05-23', 'Concluído', 'Pix'),
(2009, 9, '2025-05-24', 'Enviado', 'Cartão de Crédito'),
(2010, 10, '2025-05-24', 'Processando', 'Cartão de Débito');

-- Inserindo dados na tabela autor
INSERT INTO editora.autor (id_autor, nome, biografia, data_nascimento, livro_isb) VALUES
(301, 'Thomas Mann', 'Importante escritor alemão do século XX.', '1875-06-06', 1001),
(302, 'Gabriel García Márquez', 'Mestre do realismo mágico latino-americano.', '1927-03-06', 1002),
(303, 'George Orwell', 'Autor britânico conhecido por suas distopias.', '1903-06-25', 1003),
(304, 'Antoine de Saint-Exupéry', 'Escritor e aviador francês.', '1900-06-29', 1004),
(305, 'Miguel de Cervantes', 'Um dos maiores escritores da língua espanhola.', '1547-09-29', 1005),
(306, 'Jane Austen', 'Romancista inglesa icônica.', '1775-12-16', 1006),
(307, 'J.R.R. Tolkien', 'Criador da Terra Média.', '1892-01-03', 1007),
(308, 'J.K. Rowling', 'Autora da série Harry Potter.', '1965-07-31', 1008),
(309, 'Fiódor Dostoiévski', 'Um dos maiores romancistas russos.', '1821-11-11', 1009),
(310, 'Franz Kafka', 'Escritor de língua alemã do século XX.', '1883-07-03', 1010);

-- Inserindo dados na tabela exemplares
INSERT INTO editora.exemplares (numero_serie, isbn, condicao_exemplar) VALUES
(4001, '1001', 'Novo'),
(4002, '1001', 'Bom'),
(4003, '1002', 'Novo'),
(4004, '1003', 'Usado'),
(4005, '1004', 'Novo'),
(4006, '1005', 'Bom'),
(4007, '1006', 'Novo'),
(4008, '1007', 'Novo'),
(4009, '1008', 'Novo'),
(4010, '1009', 'Bom');

--  Inserindo dados na tabela palavraChave
INSERT INTO editora.palavraChave (codg_palavrachave, descrição_palavrachave, livro_isb, livro_cliente_id_cliente) VALUES
(501, 'Magia', 1008, 8),
(502, 'Amizade', 1004, 4),
(503, 'Aventura', 1005, 5),
(504, 'Romance', 1001, 1),
(505, 'Distopia', 1003, 3),
(506, 'Realismo Mágico', 1002, 2),
(507, 'Mistério', 1009, 9),
(508, 'Transformação', 1010, 10),
(509, 'Guerra', 1007, 7),
(510, 'Escola', 1008, 8);

-- Inserindo dados na tabela areaDeconhecimento
INSERT INTO editora.areaDeconhecimento (codigo_area, descrição_area, livro_isb) VALUES
(601, 'Literatura Alemã', 1001),
(602, 'Literatura Latino-Americana', 1002),
(603, 'Ficção Científica', 1003),
(604, 'Literatura Infantil', 1004),
(605, 'Literatura Espanhola', 1005),
(606, 'Romance Inglês', 1006),
(607, 'Fantasia Épica', 1007),
(608, 'Ficção Juvenil', 1008),
(609, 'Literatura Russa', 1009),
(610, 'Ficção Moderna', 1010);

-- Inserindo dados na tabela cargo
INSERT INTO editora.cargo (id_cargo, nome_cargo, descrição_cargo, funcionarios_cpf) VALUES
(701, 'Gerente de Marketing', 'Responsável pelas estratégias de marketing', '222.222.222-22'),
(702, 'Editor Chefe', 'Responsável pela linha editorial', '111.111.111-11'),
(703, 'Analista Financeiro', 'Responsável pelas finanças da empresa', '666.666.666-66'),
(704, 'Analista de RH', 'Responsável pela gestão de pessoas', '444.444.444-44'),
(705, 'Coordenador de Logística', 'Responsável pela distribuição', '333.333.333-33'),
(706, 'Analista de TI', 'Responsável pelo suporte de tecnologia', '555.555.555-55'),
(707, 'Vendedor Sênior', 'Responsável por grandes contas', '777.777.777-77'),
(708, 'Designer Gráfico', 'Responsável pelo design das capas e materiais', '888.888.888-88'),
(709, 'Advogado', 'Responsável pelos assuntos legais', '999.999.999-99'),
(710, 'Assistente Administrativo', 'Responsável pelo suporte administrativo', '000.000.000-00');

-- Inserindo dados na tabela itensVenda
INSERT INTO editora.itensVenda (valorVenda, quantidade, desconto, funcionarios_cpf, pedidoVendas_id_pedido) VALUES
(65.00, '1', 0.00, '777.777.777-77', 2001),
(40.00, '2', 0.10, '222.222.222-22', 2002),
(55.00, '1', 0.05, '777.777.777-77', 2003),
(25.00, '3', 0.15, '444.444.444-44', 2004),
(70.00, '1', 0.00, '222.222.222-22', 2005),
(45.00, '2', 0.10, '777.777.777-77', 2006),
(30.00, '1', 0.00, '444.444.444-44', 2007),
(80.00, '1', 0.05, '222.222.222-22', 2008),
(50.00, '2', 0.10, '777.777.777-77', 2009),
(35.00, '1', 0.00, '444.444.444-44', 2010);

-- Inserindo dados na tabela ferias
INSERT INTO editora.ferias (idferias, dataInicio, dataFim, qtdDias, anoRef, funcionarios_cpf) VALUES
(801, '2025-07-01', '2025-07-30', 30, 2025, '111.111.111-11'),
(802, '2025-08-01', '2025-08-15', 15, 2025, '222.222.222-22'),
(803, '2025-06-01', '2025-06-20', 20, 2025, '333.333.333-33'),
(804, '2025-09-01', '2025-09-30', 30, 2025, '444.444.444-44'),
(805, '2025-10-01', '2025-10-10', 10, 2025, '555.555.555-55'),
(806, '2025-11-01', '2025-11-25', 25, 2025, '666.666.666-66'),
(807, '2025-07-15', '2025-08-05', 21, 2025, '777.777.777-77'),
(808, '2025-08-16', '2025-08-30', 15, 2025, '888.888.888-88'),
(809, '2025-06-15', '2025-07-05', 21, 2025, '999.999.999-99'),
(810, '2025-10-11', '2025-10-25', 15, 2025, '000.000.000-00');

-- Inserindo dados na tabela enderecoFunc
INSERT INTO editora.enderecoFunc (uf, cidade, bairro, rua, numero, complemento, cep, funcionarios_cpf) VALUES
('PE', 'Recife', 'Boa Viagem', 'Rua Dezessete', 100, 'Apto 101', '51020-170', '111.111.111-11'),
('PE', 'Olinda', 'Casa Caiada', 'Av. Atlântica', 250, NULL, '53130-050', '222.222.222-22'),
('PE', 'Jaboatão dos Guararapes', 'Piedade', 'Rua da Praia', 50, NULL, '54410-000', '333.333.333-33'),
('PE', 'Recife', 'Espinheiro', 'Rua da Hora', 300, 'Casa B', '52020-010', '444.444.444-44'),
('PE', 'Paulista', 'Jardim Paulista', 'Rua das Acácias', 120, NULL, '53409-000', '555.555.555-55'),
('PE', 'Recife', 'Madalena', 'Rua Real', 400, 'Apto 202', '50610-000', '666.666.666-66'),
('PE', 'Olinda', 'Rio Doce', 'Rua da Mangueira', 180, NULL, '53080-120', '777.777.777-77'),
('PE', 'Jaboatão dos Guararapes', 'Candeias', 'Av. Bernardo Vieira de Melo', 500, NULL, '54440-000', '888.888.888-88'),
('PE', 'Recife', 'Graças', 'Rua da Amizade', 220, 'Sala 15', '52011-000', '999.999.999-99'),
('PE', 'Paulista', 'Maria Farinha', 'Av. Cláudio Gueiros Leite', 600, NULL, '53449-000', '000.000.000-00');

-- Inserindo dados na tabela enderecoCliente
INSERT INTO editora.enderecoCliente (uf, cidade, bairro, rua, numero, complemento, cep, cliente_id_cliente) VALUES
('PE', 'Recife', 'Boa Viagem', 'Rua Setubal', 150, NULL, '51030-010', 1),
('PE', 'Olinda', 'Bairro Novo', 'Av. Getúlio Vargas', 300, 'Apto 301', '53030-010', 2),
('PE', 'Jaboatão dos Guararapes', 'Piedade', 'Rua Ulisses Pernambucano', 200, NULL, '54400-000', 3),
('PE', 'Recife', 'Casa Forte', 'Av. 17 de Agosto', 450, NULL, '52060-000', 4),
('PE', 'Paulista', 'Janga', 'Rua D', 80, NULL, '53439-000', 5),
('PE', 'Recife', 'Imbiribeira', 'Av. Mascarenhas de Morais', 550, 'Casa 12', '51170-000', 6),
('PE', 'Olinda', 'Jardim Atlântico', 'Rua E', 120, NULL, '53050-000', 7),
('PE', 'Jaboatão dos Guararapes', 'Candeias', 'Rua F', 350, NULL, '54450-000', 8),
('PE', 'Recife', 'Torre', 'Rua G', 280, NULL, '50710-000', 9),
('PE', 'Paulista', 'Pau Amarelo', 'Av. João Pessoa Guerra', 650, NULL, '53417-000', 10);

-- Item 5 deletar ou atualizar

DELETE FROM editora.cliente WHERE id_cliente = 9;

DELETE FROM editora.funcionarios WHERE cpf = '333.333.333-33';

SET SQL_SAFE_UPDATES = 0;
DELETE FROM editora.livro WHERE genero = 'Infantil';

DELETE FROM editora.pedidoVendas WHERE id_pedido = 2002;

DELETE FROM editora.autor WHERE id_autor = 310;

DELETE FROM editora.exemplares WHERE numero_serie = 4004;

DELETE FROM editora.palavraChave WHERE descrição_palavrachave = 'Escola' AND livro_isb = 1008;

DELETE FROM editora.areaDeconhecimento WHERE descrição_area = 'Ficção Moderna' AND livro_isb = 1010;

DELETE FROM editora.cargo WHERE nome_cargo = 'Assistente Administrativo';

DELETE FROM editora.itensVenda WHERE pedidoVendas_id_pedido = 2002 AND funcionarios_cpf = '222.222.222-22';

UPDATE editora.cliente SET telefone_cliente = '(81) 99999-0000' WHERE nome_cliente = 'Ana Souza';

UPDATE editora.funcionarios SET salario = salario * 1.10 WHERE nome = 'Sofia Mendes';

UPDATE editora.livro SET descrição = 'Um clássico da literatura alemã ' WHERE titulo = 'A Montanha Mágica';

UPDATE editora.pedidoVendas SET status_pedido = 'Enviado' WHERE id_pedido = 2003;

UPDATE editora.autor SET biografia = 'Importante escritor alemão do século XX, ganhador do Prêmio Nobel de Literatura.' WHERE nome = 'Thomas Mann';

UPDATE editora.exemplares SET condicao_exemplar = 'Bom' WHERE numero_serie = 4003;

UPDATE editora.palavraChave SET descrição_palavrachave = 'Elementos mágicos e sobrenaturais' WHERE codg_palavrachave = 501;

UPDATE editora.areaDeconhecimento SET descrição_area = 'Obras literárias da América Latina.' WHERE codigo_area = 602;

UPDATE editora.cargo SET nome_cargo = 'Vendedor Líder' WHERE id_cargo = 707;

UPDATE editora.itensVenda SET desconto = 5.0 WHERE pedidoVendas_id_pedido = 2001;

-- item 6 perguntas

-- 1. Listar todos os clientes e seus endereços.
SELECT c.nome_cliente, ec.rua, ec.numero, ec.cidade, ec.uf
FROM editora.cliente c
JOIN editora.enderecoCliente ec ON c.id_cliente = ec.cliente_id_cliente;

-- 2. Listar todos os funcionários e seus departamentos.
SELECT f.nome, d.nome_departamento
FROM editora.funcionarios f
JOIN editora.departamento d ON f.cpf = d.funcionarios_cpf;

-- 3. Listar todos os livros e seus autores.
SELECT l.titulo, a.nome AS nome_autor
FROM editora.livro l
JOIN editora.autor a ON l.isb = a.livro_isb;

-- 4. Quais clientes compraram o livro 'Cem Anos de Solidão'?
SELECT c.nome_cliente
FROM editora.cliente c
JOIN editora.pedidoVendas pv ON c.id_cliente = pv.cliente_id_cliente
JOIN editora.itensVenda iv ON pv.id_pedido = iv.pedidoVendas_id_pedido
JOIN editora.livro l ON iv.pedidoVendas_id_pedido = l.isb -- Atenção: Ajustar a condição de JOIN conforme a estrutura real de itensVenda e livro
WHERE l.titulo = 'Cem Anos de Solidão';

-- 5. Quais funcionários têm um salário acima de 3000?
SELECT nome, salario
FROM editora.funcionarios
WHERE salario > 3000;

-- 6. Quais livros foram lançados após 01/01/2024?
SELECT titulo, data_lancamento
FROM editora.livro
WHERE data_lancamento > '2024/01/01';

-- 7. Quantos pedidos cada cliente fez?
SELECT c.nome_cliente, COUNT(pv.id_pedido) AS total_pedidos
FROM editora.cliente c
LEFT JOIN editora.pedidoVendas pv ON c.id_cliente = pv.cliente_id_cliente
GROUP BY c.nome_cliente;

-- 8. Qual o livro com o maior número de páginas?
SELECT titulo, numero_paginas
FROM editora.livro
ORDER BY numero_paginas DESC
LIMIT 1;

-- 9. Quais são as palavras-chave associadas ao livro 'Harry Potter e a Pedra Filosofal'?
SELECT pc.descrição_palavrachave
FROM editora.palavraChave pc
JOIN editora.livro l ON pc.livro_isb = l.isb
WHERE l.titulo = 'Harry Potter e a Pedra Filosofal';

-- 10. Quais funcionários tiraram férias no ano de 2025?
SELECT f.nome
FROM editora.funcionarios f
JOIN editora.ferias fer ON f.cpf = fer.funcionarios_cpf
WHERE YEAR(fer.anoRef) = 2025;

-- 11. Listar os livros e a área de conhecimento a que pertencem.
SELECT l.titulo, adc.descrição_area
FROM editora.livro l
JOIN editora.areaDeconhecimento adc ON l.isb = adc.livro_isb;

-- 12. Quais clientes fizeram pedidos com status 'Concluído'?
SELECT c.nome_cliente
FROM editora.cliente c
JOIN editora.pedidoVendas pv ON c.id_cliente = pv.cliente_id_cliente
WHERE pv.status_pedido = 'Concluído';

-- 13. Listar os funcionários e seus cargos.
SELECT f.nome, car.nome_cargo
FROM editora.funcionarios f
JOIN editora.cargo car ON f.cpf = car.funcionarios_cpf;

-- 14. Quais livros têm mais de 500 páginas e são do gênero 'Romance'?
SELECT titulo
FROM editora.livro
WHERE numero_paginas > 500 AND genero = 'Romance';

-- 15. Qual o cliente que fez o último pedido?
SELECT c.nome_cliente, pv.data_transacao
FROM editora.cliente c
JOIN editora.pedidoVendas pv ON c.id_cliente = pv.cliente_id_cliente
ORDER BY pv.data_transacao DESC
LIMIT 1;

-- 16. Listar os autores e o número de livros que escreveram.
SELECT a.nome, COUNT(l.isb) AS numero_livros
FROM editora.autor a
JOIN editora.livro l ON a.livro_isb = l.isb
GROUP BY a.nome;

-- 17. Quais funcionários trabalham no departamento de 'Marketing'?
SELECT f.nome
FROM editora.funcionarios f
JOIN editora.departamento d ON f.cpf = d.funcionarios_cpf
WHERE d.nome_departamento = 'Marketing';

-- 18. Listar os exemplares e o título do livro a que pertencem.
SELECT ex.numero_serie, l.titulo
FROM editora.exemplares ex
JOIN editora.livro l ON ex.isbn = l.isb;

-- 19. Quais clientes têm o nome começando com a letra 'A'?
SELECT nome_cliente
FROM editora.cliente
WHERE nome_cliente LIKE 'A%';

-- 20. Qual o valor total de vendas por funcionário?
SELECT f.nome, SUM(iv.valorVenda * iv.quantidade * (1 - IFNULL(iv.desconto, 0))) AS total_vendas
FROM editora.funcionarios f
JOIN editora.itensVenda iv ON f.cpf = iv.funcionarios_cpf
GROUP BY f.nome;

-- Item 7 Views

-- 1. View para listar clientes e seus endereços
CREATE VIEW vw_clientes_enderecos AS
SELECT c.nome_cliente, ec.rua, ec.numero, ec.cidade, ec.uf
FROM editora.cliente c
JOIN editora.enderecoCliente ec ON c.id_cliente = ec.cliente_id_cliente;

-- 2. View para listar funcionários e seus departamentos
CREATE VIEW vw_funcionarios_departamentos AS
SELECT f.nome, d.nome_departamento
FROM editora.funcionarios f
JOIN editora.departamento d ON f.cpf = d.funcionarios_cpf;

-- 3. View para listar livros e seus autores
CREATE VIEW vw_livros_autores AS
SELECT l.titulo, a.nome AS nome_autor
FROM editora.livro l
JOIN editora.autor a ON l.isb = a.livro_isb;

-- 4. View para mostrar o número de pedidos por cliente
CREATE VIEW vw_pedidos_por_cliente AS
SELECT c.nome_cliente, COUNT(pv.id_pedido) AS total_pedidos
FROM editora.cliente c
LEFT JOIN editora.pedidoVendas pv ON c.id_cliente = pv.cliente_id_cliente
GROUP BY c.nome_cliente;

-- 5. View para listar livros lançados após 01/01/2024
CREATE VIEW vw_livros_lancados_apos_2024 AS
SELECT titulo, data_lancamento
FROM editora.livro
WHERE data_lancamento > '2024-01-01';

-- 6. View para exibir as palavras-chave por livro
CREATE VIEW vw_palavras_chave_por_livro AS
SELECT l.titulo, GROUP_CONCAT(pc.descrição_palavrachave SEPARATOR ', ') AS palavras_chave
FROM editora.livro l
JOIN editora.palavraChave pc ON l.isb = pc.livro_isb
GROUP BY l.titulo;

-- 7. View para listar funcionários que tiraram férias em 2025
CREATE VIEW vw_funcionarios_ferias_2025 AS
SELECT f.nome
FROM editora.funcionarios f
JOIN editora.ferias fer ON f.cpf = fer.funcionarios_cpf
WHERE YEAR(fer.anoRef) = 2025;

-- 8. View para listar livros com suas áreas de conhecimento
CREATE VIEW vw_livros_com_area AS
SELECT l.titulo, GROUP_CONCAT(adc.descrição_area SEPARATOR ', ') AS areas_conhecimento
FROM editora.livro l
JOIN editora.areaDeconhecimento adc ON l.isb = adc.livro_isb
GROUP BY l.titulo;

-- 9. View para listar funcionários e seus cargos
CREATE VIEW vw_funcionarios_cargos AS
SELECT f.nome, car.nome_cargo
FROM editora.funcionarios f
JOIN editora.cargo car ON f.cpf = car.funcionarios_cpf;

-- 10. View para mostrar o total de vendas por funcionário
CREATE VIEW vw_total_vendas_por_funcionario AS
SELECT f.nome, SUM(iv.valorVenda * iv.quantidade * (1 - IFNULL(iv.desconto, 0))) AS total_vendas
FROM editora.funcionarios f
JOIN editora.itensVenda iv ON f.cpf = iv.funcionarios_cpf
GROUP BY f.nome;

-- CRIAÇÃO DA PROCEDURE

-- 1 PROCEDURE
ALTER TABLE editora.pedidoVendas
ADD COLUMN valor_total DECIMAL(10,2) DEFAULT 0.00;

DELIMITER //
CREATE PROCEDURE editora.AdicionarItemAoPedido(
    IN p_id_pedido INT,
    IN p_livro_isb INT,
    IN p_quantidade INT,
    IN p_cpf_funcionario VARCHAR(14),
    IN p_desconto DECIMAL(5,2)
)
BEGIN
    DECLARE v_preco_unitario DECIMAL(7,2);
    DECLARE v_exemplares_disponiveis INT;
    DECLARE v_item_valor_total DECIMAL(10,2);
    DECLARE v_numero_serie_exemplar DECIMAL(10); 
    DECLARE i INT DEFAULT 0;

    -- 1. Verificar se o pedido existe
    SELECT COUNT(*) INTO @pedido_existe
    FROM editora.pedidoVendas
    WHERE id_pedido = p_id_pedido;

    IF @pedido_existe = 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Pedido não encontrado. Crie o pedido primeiro.';
    END IF;

    -- 2. Obter o preço do livro (usaremos um valor fixo ou o numero_paginas como base para este exemplo)
    
    SET v_preco_unitario = 50.00; -- Exemplo: preço unitário do livro

    -- 3. Verificar a quantidade de exemplares disponíveis
    SELECT COUNT(*)
    INTO v_exemplares_disponiveis
    FROM editora.exemplares
    WHERE isbn = p_livro_isb AND condicao_exemplar IN ('Novo', 'Bom');

    -- 4. Inserir o item na venda e atualizar exemplares se houver estoque
    IF v_exemplares_disponiveis >= p_quantidade THEN
        -- Calcular o valor total do item, aplicando o desconto
        SET v_item_valor_total = (v_preco_unitario * p_quantidade) * (1 - IFNULL(p_desconto, 0));

        -- Inserir na tabela itensVenda
        INSERT INTO editora.itensVenda (valorVenda, quantidade, desconto, funcionarios_cpf, pedidoVendas_id_pedido)
        VALUES (v_preco_unitario, p_quantidade, p_desconto, p_cpf_funcionario, p_id_pedido);

        -- Atualizar a condição dos exemplares vendidos
        
        WHILE i < p_quantidade DO
            SELECT numero_serie INTO v_numero_serie_exemplar
            FROM editora.exemplares
            WHERE isbn = p_livro_isb AND condicao_exemplar IN ('Novo', 'Bom')
            LIMIT 1; -- Pega apenas um exemplar por vez

            IF v_numero_serie_exemplar IS NOT NULL THEN
                UPDATE editora.exemplares
                SET condicao_exemplar = 'Vendido'
                WHERE numero_serie = v_numero_serie_exemplar;
            END IF;
            SET i = i + 1;
        END WHILE;

        -- 5. Atualizar o valor total na tabela pedidoVendas
        UPDATE editora.pedidoVendas
        SET valor_total = valor_total + v_item_valor_total
        WHERE id_pedido = p_id_pedido;

        SELECT 'Item adicionado ao pedido com sucesso!' AS Mensagem;

    ELSE
        -- Se não houver exemplares suficientes, sinaliza um erro
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Quantidade de exemplares solicitada não disponível em estoque.';
    END IF;
END //

DELIMITER ;
-- 2 PROCEDURE

DELIMITER //

CREATE PROCEDURE editora.RegistrarLivroComAutor(
    IN p_titulo VARCHAR(100),
    IN p_numero_paginas INT,
    IN p_data_lancamento DATE,
    IN p_idioma VARCHAR(45),
    IN p_genero VARCHAR(45),
    IN p_autor_cpf_existente VARCHAR(14), 
    IN p_nome_autor_novo VARCHAR(60),     
    IN p_email_autor_novo VARCHAR(45)     
)
BEGIN
    DECLARE v_autor_cpf VARCHAR(14);
    
    -- 1. Verificar se o autor já existe
    IF p_autor_cpf_existente IS NOT NULL THEN
        SELECT cpf INTO v_autor_cpf
        FROM editora.autor
        WHERE cpf = p_autor_cpf_existente;
    END IF;

    -- 2. Se o autor não existe (ou p_autor_cpf_existente era NULL), e um novo nome foi fornecido, cadastrar o novo autor
    IF v_autor_cpf IS NULL AND p_nome_autor_novo IS NOT NULL THEN
        
        SET v_autor_cpf = CONCAT('NEW-', LPAD(FLOOR(RAND() * 99999999999), 11, '0')); -- Exemplo de geração de CPF único

        INSERT INTO editora.autor (cpf, nome_autor, email_autor, bio_autor)
        VALUES (v_autor_cpf, p_nome_autor_novo, p_email_autor_novo, 'Biografia a ser adicionada');

    ELSEIF v_autor_cpf IS NULL THEN
         SIGNAL SQLSTATE '45000'
         SET MESSAGE_TEXT = 'Erro: Autor não encontrado e nenhum nome para novo autor fornecido.';
    END IF;

    -- 3. Inserir o novo livro na tabela livro
    INSERT INTO editora.livro (isb, titulo, numero_paginas, data_lancamento, idioma, genero, autor_cpf)
    VALUES (
        FLOOR(RAND() * 1000000000), -- Gerar um ISB aleatório (em um sistema real, seria auto-incremento ou lógica específica)
        p_titulo,
        p_numero_paginas,
        p_data_lancamento,
        p_idioma,
        p_genero,
        v_autor_cpf
    );

    SELECT CONCAT('Livro "', p_titulo, '" registrado e associado ao autor CPF: ', v_autor_cpf, ' com sucesso!') AS Mensagem;

END //

DELIMITER ;
-- 3 PROCEDURE

DELIMITER //

CREATE PROCEDURE editora.AtualizarDadosCliente(
    IN p_id_cliente INT,
    IN p_novo_nome_cliente VARCHAR(45),
    IN p_novo_endereco_cliente VARCHAR(45),
    IN p_novo_telefone_cliente VARCHAR(45),
    IN p_novo_email_cliente VARCHAR(45)
)
BEGIN
    DECLARE v_cliente_existe INT DEFAULT 0;

    -- 1. Verificar se o cliente com o ID fornecido existe
    SELECT COUNT(*)
    INTO v_cliente_existe
    FROM editora.cliente
    WHERE id_cliente = p_id_cliente;

    -- 2. Se o cliente existir, prosseguir com a atualização
    IF v_cliente_existe > 0 THEN
        UPDATE editora.cliente
        SET
            nome_cliente = COALESCE(p_novo_nome_cliente, nome_cliente),        -- Atualiza se o novo valor não for NULL
            endereco_cliente = COALESCE(p_novo_endereco_cliente, endereco_cliente),
            telefone_cliente = COALESCE(p_novo_telefone_cliente, telefone_cliente),
            email_cliente = COALESCE(p_novo_email_cliente, email_cliente)
        WHERE id_cliente = p_id_cliente;

        SELECT CONCAT('Dados do cliente ID ', p_id_cliente, ' atualizados com sucesso!') AS Mensagem;
    ELSE
        -- 3. Se o cliente não existir, sinalizar um erro
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Cliente com o ID especificado não encontrado.';
    END IF;
END //

DELIMITER ;
-- 4 PROCEDURE

DELIMITER //

CREATE PROCEDURE editora.RegistrarFeriasFuncionario(
    IN p_funcionarios_cpf VARCHAR(14),
    IN p_data_inicio DATE,
    IN p_data_fim DATE,
    IN p_ano_ref INT 
)
BEGIN
    DECLARE v_conflito_ferias INT DEFAULT 0;
    DECLARE v_funcionario_existe INT DEFAULT 0;

    -- 1. Verificar se o funcionário existe
    SELECT COUNT(*) INTO v_funcionario_existe
    FROM editora.funcionarios
    WHERE cpf = p_funcionarios_cpf;

    IF v_funcionario_existe = 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Funcionário com o CPF especificado não encontrado.';
    END IF;

    -- 2. Verificar se há conflito de datas com férias já existentes para o funcionário
    SELECT COUNT(*)
    INTO v_conflito_ferias
    FROM editora.ferias
    WHERE funcionarios_cpf = p_funcionarios_cpf
      AND (
            (p_data_inicio <= data_fim AND p_data_fim >= data_inicio)
            OR
            (p_data_inicio >= data_inicio AND p_data_inicio <= data_fim)
            OR
            (p_data_fim >= data_inicio AND p_data_fim <= data_fim)
          );

    -- 3. Inserir as férias se não houver conflito
    IF v_conflito_ferias = 0 THEN
        INSERT INTO editora.ferias (id_ferias, data_inicio, data_fim, anoRef, funcionarios_cpf)
        VALUES (
            (SELECT COALESCE(MAX(id_ferias), 0) + 1 FROM editora.ferias), 
            p_data_inicio,
            p_data_fim,
            STR_TO_DATE(CONCAT(p_ano_ref, '-01-01'), '%Y-%m-%d'), 
            p_funcionarios_cpf
        );
        SELECT CONCAT('Férias para o funcionário CPF ', p_funcionarios_cpf, ' registradas com sucesso!') AS Mensagem;
    ELSE
        -- 4. Se houver conflito, sinalizar um erro
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: O período de férias solicitado conflita com férias já agendadas para este funcionário.';
    END IF;
END //

DELIMITER ;
-- 5 PROCEDURE

DELIMITER //

CREATE PROCEDURE editora.GerenciarPalavraChaveLivro(
    IN p_livro_isb INT,
    IN p_descricao_palavrachave VARCHAR(45),
    IN p_acao VARCHAR(10) -- 'ADICIONAR' ou 'REMOVER'
)
BEGIN
    DECLARE v_livro_existe INT DEFAULT 0;
    DECLARE v_palavra_chave_existe_para_livro INT DEFAULT 0;

    -- 1. Verificar se o livro existe
    SELECT COUNT(*) INTO v_livro_existe
    FROM editora.livro
    WHERE isb = p_livro_isb;

    IF v_livro_existe = 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Livro com o ISB especificado não encontrado.';
    END IF;

    -- 2. Verificar se a palavra-chave já está associada a este livro
    SELECT COUNT(*) INTO v_palavra_chave_existe_para_livro
    FROM editora.palavraChave
    WHERE livro_isb = p_livro_isb AND descrição_palavrachave = p_descricao_palavrachave;

    -- 3. Executar a ação baseada no parâmetro p_acao
    IF p_acao = 'ADICIONAR' THEN
        IF v_palavra_chave_existe_para_livro = 0 THEN
            -- Gerar um novo id_palavraChave (supondo que não é auto-incremento e precisa ser único para o par)
            INSERT INTO editora.palavraChave (id_palavraChave, descrição_palavrachave, livro_isb)
            VALUES (
                (SELECT COALESCE(MAX(id_palavraChave), 0) + 1 FROM editora.palavraChave),
                p_descricao_palavrachave,
                p_livro_isb
            );
            SELECT CONCAT('Palavra-chave "', p_descricao_palavrachave, '" adicionada ao livro ISB ', p_livro_isb, ' com sucesso!') AS Mensagem;
        ELSE
            SELECT 'Aviso: Palavra-chave já existe para este livro.' AS Mensagem;
        END IF;

    ELSEIF p_acao = 'REMOVER' THEN
        IF v_palavra_chave_existe_para_livro > 0 THEN
            DELETE FROM editora.palavraChave
            WHERE livro_isb = p_livro_isb AND descrição_palavrachave = p_descricao_palavrachave;
            SELECT CONCAT('Palavra-chave "', p_descricao_palavrachave, '" removida do livro ISB ', p_livro_isb, ' com sucesso!') AS Mensagem;
        ELSE
            SELECT 'Aviso: Palavra-chave não encontrada para este livro.' AS Mensagem;
        END IF;

    ELSE
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Ação inválida. Use "ADICIONAR" ou "REMOVER".';
    END IF;
END //

DELIMITER ;
                     -- 6 PROCEDURE

DELIMITER //

CREATE PROCEDURE editora.AtualizarCargoDeFuncionario(
    IN p_funcionarios_cpf VARCHAR(14),
    IN p_novo_nome_cargo VARCHAR(45)
)
BEGIN
    DECLARE v_funcionario_existe INT DEFAULT 0;
    DECLARE v_cargo_id INT; -- Para armazenar o ID do cargo atual do funcionário

    -- 1. Verificar se o funcionário existe
    SELECT COUNT(*) INTO v_funcionario_existe
    FROM editora.funcionarios
    WHERE cpf = p_funcionarios_cpf;

    IF v_funcionario_existe = 0 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Funcionário com o CPF especificado não encontrado.';
    END IF;

    -- 2. Encontrar o ID do cargo atual do funcionário (assumindo que há apenas um cargo por funcionário ativo na tabela 'cargo')
    SELECT id_cargo INTO v_cargo_id
    FROM editora.cargo
    WHERE funcionarios_cpf = p_funcionarios_cpf
    LIMIT 1; 

    -- 3. Se um registro de cargo for encontrado, atualizar o nome do cargo
    IF v_cargo_id IS NOT NULL THEN
        UPDATE editora.cargo
        SET nome_cargo = p_novo_nome_cargo
        WHERE id_cargo = v_cargo_id AND funcionarios_cpf = p_funcionarios_cpf;

        SELECT CONCAT('Cargo do funcionário CPF ', p_funcionarios_cpf, ' atualizado para "', p_novo_nome_cargo, '" com sucesso!') AS Mensagem;
    ELSE
        -- 4. Se não houver registro de cargo para o funcionário, sinalizar um erro
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Nenhum registro de cargo encontrado para o funcionário especificado. Verifique a tabela cargo.';
    END IF;
END //


					 -- Testando a PROCEDURE 
					 -- teste 1
  
-- Consultar estado inicial
SELECT valor_total FROM editora.pedidoVendas WHERE id_pedido = 2001;
SELECT condicao_exemplar, COUNT(*) FROM editora.exemplares WHERE isbn = '1001' GROUP BY condicao_exemplar;
SELECT * FROM editora.itensVenda WHERE pedidoVendas_id_pedido = 2001 AND funcionarios_cpf = '777.777.777-77';

DELETE FROM editora.itensVenda
WHERE pedidoVendas_id_pedido = 2001 AND funcionarios_cpf = '777.777.777-77';

CALL editora.AdicionarItemAoPedido(
    2001, -- p_id_pedido
    1001, -- p_livro_isb
    1,    -- p_quantidadelivro
    '777.777.777-77', -- p_cpf_funcionario
    0.00  -- p_desconto
);
-- Consultar estado final
SELECT valor_total FROM editora.pedidoVendas WHERE id_pedido = 2001;
SELECT condicao_exemplar, COUNT(*) FROM editora.exemplares WHERE isbn = '1001' GROUP BY condicao_exemplar;
SELECT * FROM editora.itensVenda WHERE pedidoVendas_id_pedido = 2001 AND funcionarios_cpf = '777.777.777-77';

						-- teste 2
						-- Exemplo de como adicionar mais exemplares para o teste:
INSERT INTO editora.exemplares (numero_serie, isbn, condicao_exemplar) VALUES
(4014, '1006', 'Novo'), 
(4015, '1006', 'Bom'),
(4016, '1006', 'Novo');
-- Cenário de Sucesso: Adicionar 2 livros 'Orgulho e Preconceito' (ISB 1006) ao Pedido 2006 (Cliente 6), com 10% de desconto.


DELETE FROM editora.itensVenda
WHERE pedidoVendas_id_pedido = 2006 AND funcionarios_cpf = '777.777.777-77';

-- Consultar estado inicial
SELECT valor_total FROM editora.pedidoVendas WHERE id_pedido = 2006;
SELECT condicao_exemplar, COUNT(*) FROM editora.exemplares WHERE isbn = '1006' GROUP BY condicao_exemplar;
SELECT * FROM editora.itensVenda WHERE pedidoVendas_id_pedido = 2006 AND funcionarios_cpf = '777.777.777-77';

-- Chamar a procedure
CALL editora.AdicionarItemAoPedido(
    2006, -- p_id_pedido (Pedido 'Concluído' do cliente 6)
    1006, -- p_livro_isb ('Orgulho e Preconceito')
    2,    -- p_quantidade
    '777.777.777-77', -- p_cpf_funcionario (Ricardo Alves)
    0.10  -- p_desconto (10%)
);

                     -- teste 3
                     -- Cenário de Erro: Tentar adicionar item a um pedido que não existe (ID 9999).

-- Chamar a procedure com um ID de pedido inexistente
CALL editora.AdicionarItemAoPedido(
    9999, -- p_id_pedido (ID inexistente)
    1001, -- p_livro_isb
    1,    -- p_quantidade
    '777.777.777-77', -- p_cpf_funcionario
    0.00  -- p_desconto
);

						-- teste 4
						-- Cenário de Erro: Tentar adicionar mais exemplares do que o disponível para o livro 'O Pequeno Príncipe' (ISB 1004).

-

--  Consultar estoque inicial do livro 1004 ('O Pequeno Príncipe')
SELECT condicao_exemplar, COUNT(*) FROM editora.exemplares WHERE isbn = '1004' GROUP BY condicao_exemplar;

-- Chamar a procedure tentando adicionar 2 exemplares, mas só tem 1 'Novo'
CALL editora.AdicionarItemAoPedido(
    2004, -- p_id_pedido (Pedido 'Enviado' do cliente 4)
    1004, -- p_livro_isb ('O Pequeno Príncipe')
    2,    -- p_quantidade (mais do que o disponível)
    '444.444.444-44', -- p_cpf_funcionario (Amanda Pereira)
    0.00  -- p_desconto
);

-- Consultar estoque final para verificar se nada mudou (esperado)
SELECT condicao_exemplar, COUNT(*) FROM editora.exemplares WHERE isbn = '1004' GROUP BY condicao_exemplar;
--  Consultar estado final
SELECT valor_total FROM editora.pedidoVendas WHERE id_pedido = 2006;
SELECT condicao_exemplar, COUNT(*) FROM editora.exemplares WHERE isbn = '1006' GROUP BY condicao_exemplar;
SELECT * FROM editora.itensVenda WHERE pedidoVendas_id_pedido = 2006 AND funcionarios_cpf = '777.777.777-77';

					-- Criando as fuctions

DELIMITER //

-- 1. FUNCAO_CalcularIdadeFuncionario
CREATE FUNCTION FUNCAO_CalcularIdadeFuncionario2(p_cpf VARCHAR(14))
RETURNS INT
DETERMINISTIC
READS SQL DATA -- Esta linha precisa estar em todas!
BEGIN
    DECLARE dataNasc  DATE;
    DECLARE v_idade INT;

    SELECT data_nascimento INTO v_data_nascimento
    FROM editora.funcionarios
    WHERE cpf = p_cpf;

    IF v_data_nascimento IS NULL THEN
        RETURN NULL; -- Retorna NULL em caso de erro, não SIGNAL SQLSTATE
    END IF;

    SET v_idade = TIMESTAMPDIFF(YEAR, v_data_nascimento, CURDATE());

    IF (MONTH(CURDATE()) < MONTH(v_data_nascimento)) OR
       (MONTH(CURDATE()) = MONTH(v_data_nascimento) AND DAY(CURDATE()) < DAY(v_data_nascimento)) THEN
        SET v_idade = v_idade - 1;
    END IF;

    RETURN v_idade;
END //

-- 2. FUNCAO_ContarLivrosVendidosPorAutor
CREATE FUNCTION FUNCAO_ContarLivrosVendidosPorAutor(p_id_autor INT)
RETURNS INT
DETERMINISTIC
READS SQL DATA -- Adicione aqui também!
BEGIN
    DECLARE v_total_vendidos INT;


    SELECT COUNT(e.numero_serie) INTO v_total_vendidos
    FROM editora.exemplares e
    JOIN editora.livro l ON e.isbn = l.isb
    -- Aqui, a junção `a.livro_isb` significa que um autor é 'dono' de um `livro_isb` específico na tabela autor
    JOIN editora.autor a ON l.isb = a.livro_isb -- Ajuste na junção para ser consistente com seu DDL de autor
    WHERE a.id_autor = p_id_autor AND e.condicao_exemplar = 'Vendido';

    RETURN v_total_vendidos;
END //

-- 3. FUNCAO_CalcularTotalVendasCliente
CREATE FUNCTION FUNCAO_CalcularTotalVendasCliente(p_id_cliente INT)
RETURNS DECIMAL(10, 2)
DETERMINISTIC
READS SQL DATA -- Adicione aqui!
BEGIN
    DECLARE v_total_gasto DECIMAL(10, 2);

    SELECT SUM(pv.valor_total) INTO v_total_gasto
    FROM editora.pedidoVendas pv
    WHERE pv.cliente_id_cliente = p_id_cliente;

    IF v_total_gasto IS NULL THEN
        RETURN 0.00;
    END IF;

    RETURN v_total_gasto;
END //

-- 4. FUNCAO_ObterQtdExemplaresDisponiveis
CREATE FUNCTION FUNCAO_ObterQtdExemplaresDisponiveis(p_livro_isb INT)
RETURNS INT
DETERMINISTIC
READS SQL DATA -- Adicione aqui!
BEGIN
    DECLARE v_qtd_disponivel INT;

    SELECT COUNT(*) INTO v_qtd_disponivel
    FROM editora.exemplares
    WHERE isbn = p_livro_isb
      AND (condicao_exemplar = 'Novo' OR condicao_exemplar = 'Bom');

    RETURN v_qtd_disponivel;
END //

-- 5. FUNCAO_VerificarStatusFeriasFuncionario
-- Esta função verifica se um funcionário está de férias na data atual.
CREATE FUNCTION FUNCAO_VerificarStatusFeriasFuncionario(p_cpf VARCHAR(14))
RETURNS VARCHAR(20)
DETERMINISTIC
READS SQL DATA -- Indica que a função apenas lê dados, não os modifica.
BEGIN
    DECLARE v_status_ferias VARCHAR(20);
    DECLARE v_data_inicio_ferias DATE; 
    DECLARE v_data_fim_ferias DATE;     

    
    SELECT dataInicio, dataFim 
    INTO v_data_inicio_ferias, v_data_fim_ferias
    FROM editora.ferias
    WHERE funcionarios_cpf = p_cpf
    AND CURDATE() BETWEEN dataInicio AND dataFim 
    LIMIT 1; 

    -- Verifica se foram encontradas datas de férias ativas
    IF v_data_inicio_ferias IS NOT NULL AND v_data_fim_ferias IS NOT NULL THEN
        SET v_status_ferias = 'Em Férias';
    ELSE
        SET v_status_ferias = 'Não em Férias';
    END IF;

    RETURN v_status_ferias;
END //

-- 6. FUNCAO_ContarLivrosPorAreaConhecimento
CREATE FUNCTION FUNCAO_ContarLivrosPorAreaConhecimento(p_id_area INT)
RETURNS INT
DETERMINISTIC
READS SQL DATA -- Adicione aqui!
BEGIN
    DECLARE v_total_livros INT;

  
    SELECT COUNT(l.isb) INTO v_total_livros
    FROM editora.livro l
    JOIN editora.areaDeconhecimento a ON l.isb = a.livro_isb -- Ajuste na junção
    WHERE a.codigo_area = p_id_area; -- Usando codigo_area, que é a PK ou parte da PK

    RETURN v_total_livros;
END //

DELIMITER ;
SELECT FUNCAO_CalcularIdadeFuncionario('111.111.111-11') AS IdadeCarlosAlberto;

              -- testando as fuctions
               -- test 1
 
SELECT FUNCAO_CalcularIdadeFuncionario('111.111.111-11') AS IdadeCarlosAlberto;
SELECT FUNCAO_CalcularIdadeFuncionario('222.222.222-22') AS IdadeSofiaMendes;

              -- teste 2
              
 -- Tcliente que fez compras (Ex: Ana Souza - ID 1, Pedro Alves - ID 2)
SELECT FUNCAO_CalcularTotalVendasCliente(1) AS TotalVendasAnaSouza;
SELECT FUNCAO_CalcularTotalVendasCliente(2) AS TotalVendasPedroAlves;

-- Testar cliente que pode não ter feito pedidos (se houver algum) ou um ID de cliente inexistente
SELECT FUNCAO_CalcularTotalVendasCliente(999) AS TotalVendasClienteInexistente;             
              
              -- test 3
			
-- autor que tem livros vendidos (Ex: Thomas Mann - ID 301, se 1001 foi vendido)
SELECT FUNCAO_ContarLivrosVendidosPorAutor(301) AS LivrosVendidosThomasMann;
-- autor que pode não ter livros vendidos ou cujos livros não foram marcados como 'Vendido'
SELECT FUNCAO_ContarLivrosVendidosPorAutor(304) AS LivrosVendidosSaintExupery;
-- Testar autor inexistente
SELECT FUNCAO_ContarLivrosVendidosPorAutor(999) AS LivrosVendidosAutorInexistente;             
              
              -- teste 4
              
 --  livro com exemplares disponíveis (Ex: A Montanha Mágica - ISB 1001)
SELECT FUNCAO_ObterQtdExemplaresDisponiveis(1001) AS ExemplaresDisponiveisMontanhaMagica;
--  livro com poucos ou nenhum exemplar disponível (Ex: O Pequeno Príncipe - ISB 1004, se foi "vendido" no teste da procedure)
SELECT FUNCAO_ObterQtdExemplaresDisponiveis(1004) AS ExemplaresDisponiveisPequenoPrincipe;
-- livro inexistente
SELECT FUNCAO_ObterQtdExemplaresDisponiveis(9999) AS ExemplaresDisponiveisLivroInexistente;             

             -- teste 5 
             
 -- Testar funcionário que está de férias (ajuste a data atual do seu sistema se for testar outros períodos)
SELECT FUNCAO_VerificarStatusFeriasFuncionario('999.999.999-99') AS StatusFeriasMarceloSantos; -- Deve retornar 'Em Férias'
-- Testar funcionário que não está de férias
SELECT FUNCAO_VerificarStatusFeriasFuncionario('111.111.111-11') AS StatusFeriasCarlosAlberto; -- Deve retornar 'Não em Férias'
-- Testar funcionário que já esteve de férias e saiu
SELECT FUNCAO_VerificarStatusFeriasFuncionario('333.333.333-33') AS StatusFeriasRobertoSilva; -- Deve retornar 'Não em Férias' (férias até 20/06/2025)
-- Testar funcionário inexistente
SELECT FUNCAO_VerificarStatusFeriasFuncionario('123.456.789-00') AS StatusFeriasFuncionarioInexistente;


			 -- teste 6
             
-- Testar área com livros (Ex: Literatura Alemã - ID 601, Fantasia Épica - ID 607)
SELECT FUNCAO_ContarLivrosPorAreaConhecimento(601) AS LivrosLiteraturaAlema;
SELECT FUNCAO_ContarLivrosPorAreaConhecimento(607) AS LivrosFantasiaEpica;
-- Testar área sem livros ou inexistente
SELECT FUNCAO_ContarLivrosPorAreaConhecimento(999) AS LivrosAreaInexistente;             

      -- criando as trigger

-- 1. Trigger para atualizar data de cadastro automaticamente
DELIMITER //
CREATE TRIGGER trg_set_data_cadastro_cliente
BEFORE INSERT ON editora.cliente
FOR EACH ROW
BEGIN
    SET NEW.data_cadastro = CURDATE();
END;
//
DELIMITER ;

-- 2. Trigger para impedir livros com mais de 2000 páginas
DELIMITER //
CREATE TRIGGER trg_limitar_paginas_livro
BEFORE INSERT ON editora.livro
FOR EACH ROW
BEGIN
    IF NEW.numero_paginas > 2000 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Número de páginas não pode ser maior que 2000.';
    END IF;
END;
//
DELIMITER ;

-- 3. Trigger para marcar funcionário como inativo ao ser demitido
DELIMITER //
CREATE TRIGGER trg_inativar_funcionario
BEFORE UPDATE ON editora.funcionarios
FOR EACH ROW
BEGIN
    IF NEW.dataDem IS NOT NULL AND OLD.dataDem IS NULL THEN
        SET NEW.ativo = FALSE;
    END IF;
END;
//
DELIMITER ;

-- 4. Trigger para logar mudanças de salário
CREATE TABLE IF NOT EXISTS editora.log_salario (
    id_log INT AUTO_INCREMENT PRIMARY KEY,
    cpf_funcionario VARCHAR(14),
    salario_antigo DECIMAL(7,2),
    salario_novo DECIMAL(7,2),
    data_alteracao DATETIME
);

DELIMITER //
CREATE TRIGGER trg_log_salario_update
AFTER UPDATE ON editora.funcionarios
FOR EACH ROW
BEGIN
    IF OLD.salario <> NEW.salario THEN
        INSERT INTO editora.log_salario (cpf_funcionario, salario_antigo, salario_novo, data_alteracao)
        VALUES (OLD.cpf, OLD.salario, NEW.salario, NOW());
    END IF;
END;
//
DELIMITER ;

-- 5. Trigger para impedir exclusão de livros com exemplares disponíveis
DELIMITER //
CREATE TRIGGER trg_prevent_delete_livro_com_exemplares
BEFORE DELETE ON editora.livro
FOR EACH ROW
BEGIN
    IF EXISTS (
        SELECT 1 FROM editora.exemplares
        WHERE isbn = OLD.isb AND condicao_exemplar IN ('Novo', 'Bom')
    ) THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Erro: Não é permitido excluir livro com exemplares disponíveis.';
    END IF;
END;
//
DELIMITER ;

-- 6. Trigger: Ao atualizar o status de um pedido para 'Concluído',

DELIMITER //
CREATE TRIGGER trg_atualiza_detalhes_pagamento_quando_concluido
BEFORE UPDATE ON editora.pedidoVendas
FOR EACH ROW
BEGIN
    IF OLD.status_pedido <> 'Concluído' AND NEW.status_pedido = 'Concluído' THEN
        SET NEW.detalhes_pagamento = 'Pagamento Finalizado';
    END IF;
END;
//
DELIMITER ;
 
	       -- testando as trigger
           
           
  -- Teste 1: Inserir cliente e verificar data_cadastro automática
INSERT INTO editora.cliente (id_cliente, nome_cliente, endereco_cliente, telefone_cliente, email_cliente)
VALUES (12, 'Teste de Cadastro', 'Rua y', '(81) 99999-9990', 'teste@dataccad.com');

SELECT * FROM editora.cliente WHERE id_cliente = 12;

-- Teste 2: Inserir livro com mais de 2000 páginas (deve dar erro)
INSERT INTO editora.livro (isb, titulo, editora, data_lancamento, genero, numero_paginas, cliente_id_cliente)
VALUES (9999, 'Livro Gigante', 'Editora Teste', NOW(), 'Drama', 2500, 1);

-- Teste 3: Atualizar dataDem e verificar ativo = FALSE
UPDATE editora.funcionarios SET dataDem = CURDATE() WHERE cpf = '444.444.444-44';

SELECT nome, ativo FROM editora.funcionarios WHERE cpf = '444.444.444-44';

-- Teste 4: Atualizar salário e verificar log
UPDATE editora.funcionarios SET salario = salario + 500 WHERE cpf = '111.111.111.11';

SELECT * FROM editora.log_salario WHERE cpf_funcionario = '111.111.111.11';

-- Teste 5: Tentar excluir livro com exemplares disponíveis (deve dar erro)
DELETE FROM editora.livro WHERE isb = 1001;

-- Verificar antes:
SELECT * FROM editora.pedidoVendas WHERE id_pedido = 2007;

-- Teste 6: Atualizar para "Concluído"
UPDATE editora.pedidoVendas
SET status_pedido = 'Concluído'
WHERE id_pedido = 2007;

-- Verificar depois:
SELECT * FROM editora.pedidoVendas WHERE id_pedido = 2007;
           		
 
SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
